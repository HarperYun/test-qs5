import{j as ie,a_ as ne,aZ as oe,bf as ue,a$ as re,bg as de,b1 as ce,r as D,b0 as me,bh as fe,bi as pe,c as v,b2 as $,bj as ge,h as x,b6 as ve,g as be,t as ye,l as xe,bk as _e,bl as he,ad as Ve,aa as w,U as _,as as K,_ as d,d as o,X as h,W as f,ba as we,V as Q,F as O,aN as P,au as q,be as qe,ax as Ce,ay as Fe,aF as j,aL as ke,bm as Se,L as A,aw as Qe,a0 as Pe,az as je,a1 as Ae}from"./index.59abb544.js";import{b as Le,Q as De}from"./QSelect.f1472b2b.js";import{Q as Ie}from"./QForm.3a912e8d.js";import{Q as R,a as Ne,b as L}from"./QList.6eaba74e.js";import"./selection.31364373.js";import"./rtl.4b414a6d.js";var Ue=ie({name:"QFile",inheritAttrs:!1,props:{...ne,...oe,...ue,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...re,...de],setup(l,{slots:u,emit:n,attrs:e}){const{proxy:p}=be(),m=ce(),b=D(null),C=D(!1),i=me(l),{pickFiles:t,onDragover:s,onDragleave:y,processFiles:I,getDndNode:W}=fe({editable:m.editable,dnd:C,getFileInput:z,addFilesToQueue:B}),X=pe(l),r=v(()=>Object(l.modelValue)===l.modelValue?"length"in l.modelValue?Array.from(l.modelValue):[l.modelValue]:[]),N=v(()=>$(r.value)),Z=v(()=>r.value.map(a=>a.name).join(", ")),U=v(()=>ge(r.value.reduce((a,c)=>a+c.size,0))),G=v(()=>({totalSize:U.value,filesNumber:r.value.length,maxFiles:l.maxFiles})),H=v(()=>({tabindex:-1,type:"file",title:"",accept:l.accept,capture:l.capture,name:i.value,...e,id:m.targetUid.value,disabled:m.editable.value!==!0})),J=v(()=>"q-file q-field--auto-height"+(C.value===!0?" q-file--dnd":"")),E=v(()=>l.multiple===!0&&l.append===!0);function F(a){const c=r.value.slice();c.splice(a,1),k(c)}function Y(a){const c=r.value.findIndex(a);c>-1&&F(c)}function k(a){n("update:modelValue",l.multiple===!0?a:a[0])}function ee(a){a.keyCode===13&&ye(a)}function te(a){(a.keyCode===13||a.keyCode===32)&&t(a)}function z(){return b.value}function B(a,c){const g=I(a,c,r.value,E.value),S=z();S!=null&&(S.value=""),g!==void 0&&((l.multiple===!0?l.modelValue&&g.every(se=>r.value.includes(se)):l.modelValue===g[0])||k(E.value===!0?r.value.concat(g):g))}function V(){return[x("input",{class:[l.inputClass,"q-file__filler"],style:l.inputStyle})]}function le(){if(u.file!==void 0)return r.value.length===0?V():r.value.map((c,g)=>u.file({index:g,file:c,ref:this}));if(u.selected!==void 0)return r.value.length===0?V():u.selected({files:r.value,ref:this});if(l.useChips===!0)return r.value.length===0?V():r.value.map((c,g)=>x(Le,{key:"file-"+g,removable:m.editable.value,dense:!0,textColor:l.color,tabindex:l.tabindex,onRemove:()=>{F(g)}},()=>x("span",{class:"ellipsis",textContent:c.name})));const a=l.displayValue!==void 0?l.displayValue:Z.value;return a.length>0?[x("div",{class:l.inputClass,style:l.inputStyle,textContent:a})]:V()}function ae(){const a={ref:b,...H.value,...X.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:B};return l.multiple===!0&&(a.multiple=!0),x("input",a)}return Object.assign(m,{fieldClass:J,emitValue:k,hasValue:N,inputRef:b,innerValue:r,floatingLabel:v(()=>N.value===!0||$(l.displayValue)),computedCounter:v(()=>{if(l.counterLabel!==void 0)return l.counterLabel(G.value);const a=l.maxFiles;return`${r.value.length}${a!==void 0?" / "+a:""} (${U.value})`}),getControlChild:()=>W("file"),getControl:()=>{const a={ref:m.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:l.tabindex};return m.editable.value===!0&&Object.assign(a,{onDragover:s,onDragleave:y,onKeydown:ee,onKeyup:te}),x("div",a,[ae()].concat(le()))}}),Object.assign(p,{removeAtIndex:F,removeFile:Y,getNativeElement:()=>b.value}),ve(m)}});function M(l){if(l===!1)return 0;if(l===!0||l===void 0)return 1;const u=parseInt(l,10);return isNaN(u)?0:u}var T=xe({name:"close-popup",beforeMount(l,{value:u}){const n={depth:M(u),handler(e){n.depth!==0&&setTimeout(()=>{const p=_e(l);p!==void 0&&he(p,e,n.depth)})},handlerKey(e){Ve(e,13)===!0&&n.handler(e)}};l.__qclosepopup=n,l.addEventListener("click",n.handler),l.addEventListener("keyup",n.handlerKey)},updated(l,{value:u,oldValue:n}){u!==n&&(l.__qclosepopup.depth=M(u))},beforeUnmount(l){const u=l.__qclosepopup;l.removeEventListener("click",u.handler),l.removeEventListener("keyup",u.handlerKey),delete l.__qclosepopup}});const Ee=d("div",{class:"window-width text-center"},[d("h5",null,[d("b",null,"\u5546\u54C1\u7BA1\u7406")])],-1),ze={class:"q-ma-md"},Be={style:{"max-width":"80vw","box-shadow":"none"}},$e={class:"row justify-center"},Ke={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Oe={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Re={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Me={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Te={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},We={class:"row items-start"},Xe={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Ze=["src"],Ge=d("p",null,"\u6C92\u6709\u5546\u54C1",-1),He={class:"q-ma-md"},st={__name:"ProductsPage",setup(l){const u=w(["\u5929\u7136\u77F3\u624B\u934A","\u881F\u7DDA\u7DE8\u7E69","\u5E03\u54C1\u624B\u4F5C","\u68C9\u9EBB\u7DE8\u7E54"]);D("");const n=w([]),e=w({_id:"",name:"",price:0,category:"",sell:!1,image:[],description:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),p=w({required(i){return!!i||"\u5FC5\u586B"},price(i){return i>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(i){var t,s,y;return!i||!i.length||((s=(t=i[0])==null?void 0:t.type)==null?void 0:s.includes("image"))&&((y=i[0])==null?void 0:y.size)<2048*2048||"\u6A94\u6848\u8D85\u904E4 MB \u6216 \u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),m=(i,t)=>{e._id=i,t>-1?(e.name=n[t].name,e.price=n[t].price,e.category=n[t].category,e.sell=n[t].sell,e.description=n[t].description):(e.name="",e.price=0,e.category="",e.sell=!1,e.description=""),e.image=[],e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},b=async()=>{if(console.log(123),e.valid)return;e.submitting=!0,console.log(456);const i=new FormData;for(const t in e)["_id","idx","dialog","valid","submitting"].includes(t)||(t==="image"?i.append(t,e[t][0]):i.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await P.post("/products",i);n.push(t.result),q.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await P.patch("/products/"+e._id,i);n[e.idx]=t.result,q.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(t){q.fire({icon:"success",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1};return(async()=>{try{const{data:i}=await P.get("/products/all");n.push(...i.result)}catch(i){console.log(i),q.fire({icon:"error",title:"\u5931\u6557",text:i.isAxiosError?i.response.data.message:i.message})}})(),(i,t)=>(_(),K(O,null,[Ee,d("div",ze,[o(h,{class:"justify-center",color:"blue-grey-10 text-teal-2",icon:"add_circle_outline",onClick:t[0]||(t[0]=s=>m("",-1)),label:"\u65B0\u589E\u5546\u54C1"})]),d("div",null,[o(we,{modelValue:e.dialog,"onUpdate:modelValue":t[9]||(t[9]=s=>e.dialog=s),persistent:""},{default:f(()=>[d("div",Be,[o(Ie,{modelValue:e.valid,"onUpdate:modelValue":t[8]||(t[8]=s=>e.valid=s),onSubmit:qe(b,["prevent"])},{default:f(()=>[o(Ce,{style:{width:"700px","max-width":"80vw"}},{default:f(()=>[o(Fe,null,{default:f(()=>[d("div",$e,[d("div",Ke,[o(j,{filled:"",modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=s=>e.name=s),rules:[p.required],label:"\u540D\u7A31"},null,8,["modelValue","rules"])]),d("div",Oe,[o(j,{filled:"",type:"number",rules:[p.required,p.price],modelValue:e.price,"onUpdate:modelValue":t[2]||(t[2]=s=>e.price=s),label:"\u50F9\u683C"},null,8,["rules","modelValue"])]),d("div",Re,[o(De,{filled:"",options:u,rules:[p.required],modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=s=>e.category=s),label:"\u5206\u985E"},null,8,["options","rules","modelValue"])]),d("div",Me,[o(ke,{modelValue:e.sell,"onUpdate:modelValue":t[4]||(t[4]=s=>e.sell=s),label:"\u662F\u5426\u4E0A\u67B6"},null,8,["modelValue"])]),d("div",Te,[d("div",We,[o(Ue,{modelValue:e.image,"onUpdate:modelValue":t[5]||(t[5]=s=>e.image=s),label:"\u4E0A\u50B3\u5716\u7247",accept:"image/*",filled:"",counter:"",multiple:"","max-files":"6",style:{"max-width":"300px"},rules:[p.size]},null,8,["modelValue","rules"])])]),d("div",Xe,[o(j,{filled:"",type:"textarea",modelValue:e.description,"onUpdate:modelValue":t[6]||(t[6]=s=>e.description=s),label:"\u5546\u54C1\u63CF\u8FF0"},null,8,["modelValue"])])])]),_:1}),o(Se,{align:"center",class:"q-mb-md"},{default:f(()=>[A(o(h,{class:"bg-blue-grey-10 text-white",type:"submit",loading:e.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[T]]),A(o(h,{class:"bg-white text-blue-grey-10",disabled:e.submitting,onClick:t[7]||(t[7]=s=>e.dialog=!1),label:"\u53D6\u6D88"},null,8,["disabled"]),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])])]),_:1},8,["modelValue"])]),n.length>0?(_(),Q(R,{key:0,separator:"",class:"q-pa-xs q-ma-none",style:{width:"80vw",margin:"auto"},bordered:""},{default:f(()=>[(_(!0),K(O,null,Qe(n,(s,y)=>A((_(),Q(Ne,{clickable:"",class:"q-ma-none",key:s._id},{default:f(()=>[o(L,{avatar:""},{default:f(()=>[d("img",{style:{"max-width":"10vw"},src:s.image},null,8,Ze)]),_:2},1024),o(L,null,{default:f(()=>[Pe(je(s.name),1)]),_:2},1024),o(L,{class:"q-pa-sm q-gutter-sm justify-end"},{default:f(()=>[o(h,{class:"bg-green-10 text-white self-end",style:{},onClick:I=>m(s._id,y),icon:"border_color",label:"\u7DE8\u8F2F"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)),[[Ae]])),128))]),_:1})):(_(),Q(R,{key:1,class:"text-center"},{default:f(()=>[Ge]),_:1})),d("div",He,[o(h,{class:"justify-center",color:"blue-grey-10 text-teal-2",icon:"add_circle_outline",onClick:t[10]||(t[10]=s=>m("",-1)),label:"\u65B0\u589E\u5546\u54C1"})])],64))}};export{st as default};
