import{j as se,a$ as ne,a_ as oe,bf as ue,b0 as re,bg as de,b2 as ce,r as k,b1 as me,bh as fe,bi as pe,c as v,b3 as K,bj as ge,h as x,b7 as ve,g as be,t as ye,l as xe,bk as he,bl as _e,ad as Ve,aa as C,U as h,ap as O,_ as d,d as o,X as _,W as f,bb as we,V as A,F as R,aJ as I,ar as F,aI as qe,au as Ce,aB as Fe,aC as D,aN as ke,bm as Se,L,at as Qe,a0 as Pe,aw as je,bn as Ae,a1 as Ie}from"./index.5b6571e3.js";import{b as De,Q as Le}from"./QSelect.6e5d5e91.js";import{Q as Ne}from"./QForm.9fb8cf1c.js";import{Q as T,a as Ue,b as N}from"./QList.26bf18e2.js";import"./selection.58f4fa59.js";import"./rtl.4b414a6d.js";var Ee=se({name:"QFile",inheritAttrs:!1,props:{...ne,...oe,...ue,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...re,...de],setup(l,{slots:u,emit:n,attrs:e}){const{proxy:p}=be(),m=ce(),b=k(null),S=k(!1),V=me(l),{pickFiles:s,onDragover:t,onDragleave:i,processFiles:y,getDndNode:w}=fe({editable:m.editable,dnd:S,getFileInput:$,addFilesToQueue:z}),W=pe(l),r=v(()=>Object(l.modelValue)===l.modelValue?"length"in l.modelValue?Array.from(l.modelValue):[l.modelValue]:[]),U=v(()=>K(r.value)),X=v(()=>r.value.map(a=>a.name).join(", ")),E=v(()=>ge(r.value.reduce((a,c)=>a+c.size,0))),G=v(()=>({totalSize:E.value,filesNumber:r.value.length,maxFiles:l.maxFiles})),H=v(()=>({tabindex:-1,type:"file",title:"",accept:l.accept,capture:l.capture,name:V.value,...e,id:m.targetUid.value,disabled:m.editable.value!==!0})),Y=v(()=>"q-file q-field--auto-height"+(S.value===!0?" q-file--dnd":"")),B=v(()=>l.multiple===!0&&l.append===!0);function Q(a){const c=r.value.slice();c.splice(a,1),P(c)}function Z(a){const c=r.value.findIndex(a);c>-1&&Q(c)}function P(a){n("update:modelValue",l.multiple===!0?a:a[0])}function ee(a){a.keyCode===13&&ye(a)}function te(a){(a.keyCode===13||a.keyCode===32)&&s(a)}function $(){return b.value}function z(a,c){const g=y(a,c,r.value,B.value),j=$();j!=null&&(j.value=""),g!==void 0&&((l.multiple===!0?l.modelValue&&g.every(ie=>r.value.includes(ie)):l.modelValue===g[0])||P(B.value===!0?r.value.concat(g):g))}function q(){return[x("input",{class:[l.inputClass,"q-file__filler"],style:l.inputStyle})]}function le(){if(u.file!==void 0)return r.value.length===0?q():r.value.map((c,g)=>u.file({index:g,file:c,ref:this}));if(u.selected!==void 0)return r.value.length===0?q():u.selected({files:r.value,ref:this});if(l.useChips===!0)return r.value.length===0?q():r.value.map((c,g)=>x(De,{key:"file-"+g,removable:m.editable.value,dense:!0,textColor:l.color,tabindex:l.tabindex,onRemove:()=>{Q(g)}},()=>x("span",{class:"ellipsis",textContent:c.name})));const a=l.displayValue!==void 0?l.displayValue:X.value;return a.length>0?[x("div",{class:l.inputClass,style:l.inputStyle,textContent:a})]:q()}function ae(){const a={ref:b,...H.value,...W.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:z};return l.multiple===!0&&(a.multiple=!0),x("input",a)}return Object.assign(m,{fieldClass:Y,emitValue:P,hasValue:U,inputRef:b,innerValue:r,floatingLabel:v(()=>U.value===!0||K(l.displayValue)),computedCounter:v(()=>{if(l.counterLabel!==void 0)return l.counterLabel(G.value);const a=l.maxFiles;return`${r.value.length}${a!==void 0?" / "+a:""} (${E.value})`}),getControlChild:()=>w("file"),getControl:()=>{const a={ref:m.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:l.tabindex};return m.editable.value===!0&&Object.assign(a,{onDragover:t,onDragleave:i,onKeydown:ee,onKeyup:te}),x("div",a,[ae()].concat(le()))}}),Object.assign(p,{removeAtIndex:Q,removeFile:Z,getNativeElement:()=>b.value}),ve(m)}});function M(l){if(l===!1)return 0;if(l===!0||l===void 0)return 1;const u=parseInt(l,10);return isNaN(u)?0:u}var J=xe({name:"close-popup",beforeMount(l,{value:u}){const n={depth:M(u),handler(e){n.depth!==0&&setTimeout(()=>{const p=he(l);p!==void 0&&_e(p,e,n.depth)})},handlerKey(e){Ve(e,13)===!0&&n.handler(e)}};l.__qclosepopup=n,l.addEventListener("click",n.handler),l.addEventListener("keyup",n.handlerKey)},updated(l,{value:u,oldValue:n}){u!==n&&(l.__qclosepopup.depth=M(u))},beforeUnmount(l){const u=l.__qclosepopup;l.removeEventListener("click",u.handler),l.removeEventListener("keyup",u.handlerKey),delete l.__qclosepopup}});const Be=d("div",{class:"window-width text-center"},[d("h5",null,[d("b",null,"\u5546\u54C1\u7BA1\u7406")])],-1),$e={class:"window-width text-center q-ma-lg"},ze={style:{"max-width":"80vw","box-shadow":"none"}},Ke={class:"row justify-center"},Oe={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Re={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Te={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Me={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Je={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},We={class:"row items-start"},Xe={class:"col-xs-12 q-ma-sm q-gutter-md",style:{"max-width":"300px"}},Ge=["src"],He=d("p",null,"\u6C92\u6709\u5546\u54C1",-1),Ye={class:"window-width text-center q-ma-lg"},st={__name:"ProductsPage",setup(l){const u=C(["\u5929\u7136\u77F3\u624B\u934A","\u881F\u7DDA\u7DE8\u7E69","\u5E03\u54C1\u624B\u4F5C","\u68C9\u9EBB\u7DE8\u7E54"]);k("");const n=C([]),e=C({_id:"",name:"",price:0,category:"",sell:!1,image:[],description:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),p=C({required(s){return!!s||"\u5FC5\u586B"},price(s){return s>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(s){var t,i,y;return!s||!s.length||((i=(t=s[0])==null?void 0:t.type)==null?void 0:i.includes("image"))&&((y=s[0])==null?void 0:y.size)<2048*2048||"\u6A94\u6848\u8D85\u904E4 MB \u6216 \u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),m=(s,t)=>{e._id=s,t>-1?(e.name=n[t].name,e.price=n[t].price,e.category=n[t].category,e.sell=n[t].sell,e.description=n[t].description):(e.name="",e.price=0,e.category="",e.sell=!1,e.description=""),e.image=[],e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},b=async()=>{if(e.valid)return;e.submitting=!0;const s=new FormData;for(const t in e)["_id","idx","dialog","valid","submitting"].includes(t)||(t==="image"?s.append(t,e[t][0]):s.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await I.post("/products",s);n.push(t.result),F.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await I.patch("/products/"+e._id,s);n[e.idx]=t.result,F.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(t){F.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1};(async()=>{try{const{data:s}=await I.get("/products/all");n.push(...s.result)}catch(s){console.log(s),F.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}})();const V=k(!0);return(s,t)=>(h(),O(R,null,[Be,d("div",$e,[o(_,{class:"justify-center",color:"blue-grey-10 text-teal-2",icon:"add_circle_outline",onClick:t[0]||(t[0]=i=>m("",-1)),label:"\u65B0\u589E\u5546\u54C1"})]),d("div",null,[o(we,{modelValue:e.dialog,"onUpdate:modelValue":t[9]||(t[9]=i=>e.dialog=i),persistent:""},{default:f(()=>[d("div",ze,[o(Ne,{modelValue:e.valid,"onUpdate:modelValue":t[8]||(t[8]=i=>e.valid=i),onSubmit:qe(b,["prevent"])},{default:f(()=>[o(Ce,{style:{width:"700px","max-width":"80vw"}},{default:f(()=>[o(Fe,null,{default:f(()=>[d("div",Ke,[d("div",Oe,[o(D,{filled:"",modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=i=>e.name=i),rules:[p.required],label:"\u540D\u7A31"},null,8,["modelValue","rules"])]),d("div",Re,[o(D,{filled:"",type:"number",rules:[p.required,p.price],modelValue:e.price,"onUpdate:modelValue":t[2]||(t[2]=i=>e.price=i),label:"\u50F9\u683C"},null,8,["rules","modelValue"])]),d("div",Te,[o(Le,{filled:"",options:u,rules:[p.required],modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=i=>e.category=i),label:"\u5206\u985E"},null,8,["options","rules","modelValue"])]),d("div",Me,[o(ke,{modelValue:e.sell,"onUpdate:modelValue":t[4]||(t[4]=i=>e.sell=i),label:"\u662F\u5426\u4E0A\u67B6"},null,8,["modelValue"])]),d("div",Je,[d("div",We,[o(Ee,{modelValue:e.image,"onUpdate:modelValue":t[5]||(t[5]=i=>e.image=i),label:"\u4E0A\u50B3\u5716\u7247",accept:"image/*",filled:"",counter:"",multiple:"","max-files":"6",style:{"max-width":"300px"},rules:[p.size]},null,8,["modelValue","rules"])])]),d("div",Xe,[o(D,{filled:"",type:"textarea",modelValue:e.description,"onUpdate:modelValue":t[6]||(t[6]=i=>e.description=i),label:"\u5546\u54C1\u63CF\u8FF0"},null,8,["modelValue"])])])]),_:1}),o(Se,{align:"center",class:"q-mb-md"},{default:f(()=>[L(o(_,{class:"bg-blue-grey-10 text-white",type:"submit",loading:e.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[J]]),L(o(_,{class:"bg-white text-blue-grey-10",disabled:e.submitting,onClick:t[7]||(t[7]=i=>e.dialog=!1),label:"\u53D6\u6D88"},null,8,["disabled"]),[[J]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])])]),_:1},8,["modelValue"])]),n.length>0?(h(),A(T,{key:0,separator:"",class:"q-pa-xs q-ma-none",style:{width:"80vw",margin:"auto"},bordered:""},{default:f(()=>[(h(!0),O(R,null,Qe(n,(i,y)=>L((h(),A(Ue,{clickable:"",class:"q-ma-none",key:i._id},{default:f(()=>[o(N,{avatar:""},{default:f(()=>[d("img",{style:{"max-width":"10vw"},src:i.image},null,8,Ge)]),_:2},1024),o(N,null,{default:f(()=>[Pe(je(i.name),1)]),_:2},1024),o(Ae,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=w=>V.value=w),label:"\u662F\u5426\u4E0A\u67B6",color:"brown-9"},null,8,["modelValue"]),o(N,{class:"q-pa-sm q-gutter-sm justify-end"},{default:f(()=>[o(_,{class:"bg-green-10 text-white self-end",style:{},onClick:w=>m(i._id,y),icon:"border_color",label:"\u7DE8\u8F2F"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)),[[Ie]])),128))]),_:1})):(h(),A(T,{key:1,class:"text-center"},{default:f(()=>[He]),_:1})),d("div",Ye,[o(_,{class:"justify-center addbtn",color:"blue-grey-10 text-teal-2",icon:"add_circle_outline",onClick:t[11]||(t[11]=i=>m("",-1)),label:"\u65B0\u589E\u5546\u54C1"})])],64))}};export{st as default};
